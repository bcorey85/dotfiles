#!/bin/bash
# Fuzzy-find a project directory and switch to (or create) a tmux session for it

selected=$({ find "$HOME/dev" -mindepth 1 -maxdepth 1 -type d 2>/dev/null; echo "$HOME/vault"; echo "$HOME/dotfiles"; } | sort -u | fzf --reverse --prompt="project> ")

if [ -z "$selected" ]; then
    exit 0
fi

session_name=$(basename "$selected" | tr '.' '_')

if tmux has-session -t="$session_name" 2>/dev/null; then
    tmux switch-client -t "$session_name"
else
    tmux new-session -d -s "$session_name" -c "$selected"
    if [[ "$selected" == "$HOME/dev/"* ]]; then
        tmux send-keys -t "$session_name" "dev" C-m
    fi
    tmux switch-client -t "$session_name"
fi
