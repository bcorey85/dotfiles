#!/bin/bash
set -e

# Colors for output
GREEN='\033[0;32m'
RED='\033[0;31m'
YELLOW='\033[1;33m'
NC='\033[0m'

print_success() { echo -e "${GREEN}✓${NC} $1"; }
print_error() { echo -e "${RED}✗${NC} $1"; }
print_info() { echo -e "${YELLOW}→${NC} $1"; }

# Usage
usage() {
  echo "Usage: ./setup [wsl|ubuntu|mac|arch]"
  echo ""
  echo "Platforms:"
  echo "  wsl     - Windows Subsystem for Linux (Ubuntu)"
  echo "  ubuntu  - Native Ubuntu/Debian"
  echo "  mac     - macOS"
  echo "  arch    - Arch Linux"
  exit 1
}

# Check if platform argument provided
if [ $# -eq 0 ]; then
  usage
fi

PLATFORM=$1

# Validate platform
if [[ ! "$PLATFORM" =~ ^(wsl|ubuntu|mac|arch)$ ]]; then
  print_error "Invalid platform: $PLATFORM"
  usage
fi

DOTFILES_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

print_info "Setting up dotfiles for: $PLATFORM"
echo ""

"$DOTFILES_DIR/install/deps" "$PLATFORM"
echo ""
"$DOTFILES_DIR/install/fonts" "$PLATFORM"
echo ""
"$DOTFILES_DIR/install/stow" "$PLATFORM"
echo ""
"$DOTFILES_DIR/install/zsh-plugins"
echo ""
"$DOTFILES_DIR/install/tmux-plugins"
echo ""
"$DOTFILES_DIR/install/starship"
echo ""
"$DOTFILES_DIR/install/claude-plugins"
echo ""
"$DOTFILES_DIR/install/zsh"
echo ""

# Create standard XDG directories
command -v xdg-user-dirs-update &>/dev/null && xdg-user-dirs-update
print_success "XDG user directories created"
echo ""

print_success "Setup complete!"
echo ""
print_info "Next steps:"
echo "  1. Restart your terminal"
echo "  2. Open Neovim and run: :Lazy sync"
echo "  3. Run: :checkhealth"
echo "  4. For kanata keyboard remapping (Linux only), run: sudo ~/kanata-setup"
echo ""
