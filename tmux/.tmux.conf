unbind C-b
set -g prefix C-Space
bind C-Space send-prefix
unbind Space

set -g base-index 1
setw -g pane-base-index 1
set -g mouse on
set -g history-limit 10000

bind | split-window -h # ctrl+b | for vertical split
bind - split-window -v # ctrl+b - for horizontal split

bind -r k select-pane -U
bind -r j select-pane -D
bind -r h select-pane -L
bind -r l select-pane -R

# Jump to panes (dev layout: 1=nvim, 2=terminal, 3=claude)
bind e select-pane -t 1
bind v select-pane -t 2
bind r select-pane -t 3

set-option -sg escape-time 10

# Fix colors and enable true color support
set -g default-terminal "tmux-256color"
set -ga terminal-features ",xterm-256color:RGB"

# Enable focus events for autoread
set -g focus-events on

# TPM plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'christoomey/vim-tmux-navigator'

# Sonokai Maia theme
set -g status-style "bg=#313b42,fg=#e1e2e3"
set -g status-left "#[bg=#78cee9,fg=#273136,bold] #S #[bg=#313b42] "
set -g status-right "#[fg=#82878b]%H:%M #[bg=#78cee9,fg=#273136,bold] #h "
set -g status-left-length 30
set -g status-right-length 40
setw -g window-status-format "#[fg=#82878b] #I:#W "
setw -g window-status-current-format "#[fg=#9cd57b,bold] #I:#W "
set -g pane-border-style "fg=#3a444b"
set -g pane-active-border-style "fg=#78cee9"
set -g message-style "bg=#3a444b,fg=#e1e2e3"
set -g mode-style "bg=#3a444b,fg=#e1e2e3"

# Sessionizer
bind f display-popup -E -w 60% -h 60% "~/.local/bin/tmux-sessionizer"

# Lazygit popup
bind g display-popup -d "#{pane_current_path}" -w 95% -h 95% -E "lazygit"

# System monitor popup
bind b display-popup -d "#{pane_current_path}" -w 95% -h 95% -E "btop"

# Project search popup (rg + fzf, opens result in nvim)
unbind /
bind / display-popup -d "#{pane_current_path}" -w 95% -h 95% -E \
  "rg --color=always --line-number --no-heading '' | fzf --ansi --delimiter=: --preview 'bat --color=always --highlight-line {2} {1}' --preview-window='up,60%' --bind 'enter:become(nvim +{2} {1})'"

# Obsidian vault search popup (enter=read in glow, ctrl-e=edit in nvim)
unbind n
bind n display-popup -w 95% -h 95% -E \
  "fd -e md . ~/vault | fzf --header 'enter=read | ctrl-e=edit' --preview 'glow -s dark {}' --preview-window='right,60%' --bind 'enter:become(glow -p {})' --bind 'ctrl-e:become(nvim {})'"

# Claude popup (prefix o toggles popup attached to persistent claude session)
# Bind both o and C-o since Ctrl is often still held from prefix
unbind C-o
bind o if-shell -F '#{m:claude-*,#{session_name}}' \
  { detach-client } \
  { display-popup -d "#{pane_current_path}" -w 95% -h 95% -E "~/.local/bin/tmux-claude" }
bind C-o if-shell -F '#{m:claude-*,#{session_name}}' \
  { detach-client } \
  { display-popup -d "#{pane_current_path}" -w 95% -h 95% -E "~/.local/bin/tmux-claude" }

# Initialize TPM (keep at bottom)
run '~/.tmux/plugins/tpm/tpm'
